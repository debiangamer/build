source "${BASH_SOURCE%/*}/include/meson64_common.inc"

if [[ $BOARD == lafrite ]]; then

	UBOOT_TARGET_MAP="u-boot-dtb.img;;u-boot.bin:u-boot.bin u-boot-dtb.img"

fi

family_tweaks()
{
	cp $SRC/config/bootscripts/amlogic/asound.conf $CACHEDIR/$SDCARD/etc/asound.conf

	cp $SRC/config/bootscripts/amlogic/905_aml_autoscript $CACHEDIR/$SDCARD/boot/aml_autoscript
	cp $SRC/config/bootscripts/amlogic/905_aml_autoscript.zip $CACHEDIR/$SDCARD/boot/aml_autoscript.zip

	# install -m 755 $SRC/lib/scripts/amlogic/905_install.sh $CACHEDIR/$SDCARD/root/install.sh
	cp $SRC/config/bootscripts/amlogic/\/905_fstab $CACHEDIR/$SDCARD/root/fstab

	cp $SRC/config/bootscripts/amlogic/905_fw_env.config $CACHEDIR/$SDCARD/etc/fw_env.config
	install -m 755 $SRC/config/bootscripts/amlogic/905_fw_printenv $CACHEDIR/$SDCARD/usr/sbin/fw_printenv
	install -m 755 $SRC/config/bootscripts/amlogic/905_fw_setenv $CACHEDIR/$SDCARD/usr/sbin/fw_setenv

	cp $SRC/config/bootscripts/boot-amlogics905x_AM.cmd $CACHEDIR/$SDCARD/boot/s905_autoscript.cmd
	mkimage -C none -A arm -T script -d $CACHEDIR/$SDCARD/boot/s905_autoscript.cmd $CACHEDIR/$SDCARD/boot/s905_autoscript

	if [ ! -d $CACHEDIR/$SDCARD/lib/firmware/ ]; then
		mkdir  $CACHEDIR/$SDCARD/lib/firmware/
		mkdir $CACHEDIR/$SDCARD/lib/firmware/brcm
	fi

	cp $SRC/config/bootscripts/amlogic/s912fw/*  $CACHEDIR/$SDCARD/lib/firmware/brcm
	cp $SRC/config/bootscripts/amlogic/10-monitor.conf  $CACHEDIR/$SDCARD/etc/X11/xorg.conf.d/
	cp $SRC/config/bootscripts/amlogic/regulatory.rules  $CACHEDIR/$SDCARD/etc/udev/rules.d/

	echo 'ttyAML0' >> $CACHEDIR/$SDCARD/etc/securetty
}

uboot_custom_postprocess()
{
	if [[ $BOARD == lepotato ]]; then
		uboot_gxl_postprocess $SRC/cache/sources/odroidc2-blobs/ gxl
	fi

	if [[ $BOARD == kvim1 ]]; then
		uboot_gxl_postprocess $SRC/cache/sources/odroidc2-blobs/ vim1
	fi

	if [[ $BOARD == kvim2 ]]; then
		uboot_gxl_postprocess_ng $SRC/cache/sources/amlogic-boot-fip/khadas-vim2
	fi
}
